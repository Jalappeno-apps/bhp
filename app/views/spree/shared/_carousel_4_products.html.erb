<style>
  .single-car-item {
    border: 1px solid red;
    border-radius: 5px;
    padding: 10px;
  }
</style>

<% cache [common_product_cache_keys, products&.maximum(:updated_at)&.to_i, id] do %>
  <div id="<%= id %>-mobile" class="carousel slide d-md-none homepage-carousel" data-interval="false">
    <div class="carousel-inner">
      <% products.each_slice(2).with_index do |sliced_items, index| %>
        <div class="carousel-item <%= 'active' if index == 0 %>">
          <div class="container">
            <div class="row carousel-items-container">
              <% sliced_items.each_with_index do |item, idx| %>
                <div class="col-6">
                  <div class="single-car-item">
                    <%= render 'spree/shared/product', product: item, image_class: 'w-100' %>
                    <%= form_for :order, html: {
                      id: 'add-to-cart-form',
                      class: 'add-to-cart-form',
                    } do |f| %>
                      <%= render 'spree/shared/quantity_select', input_name: :quantity %>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <a
      class="d-flex position-absolute justify-content-center align-items-center carousel-icon-control carousel-icon-control--previous"
      href="#<%= id %>-mobile"
      role="button"
      data-slide="prev"
    >
      <span class="d-flex justify-content-center align-items-center carousel-icon-control-rounded" aria-hidden="true">
        <%= icon(name: 'arrow-right',
                classes: 'spree-icon-arrow spree-icon-arrow-left',
                width: 20,
                height: 20) %>
      </span>
      <span class="sr-only"><%= Spree.t(:previous) %></span>
    </a>

    <a
      class="d-flex position-absolute justify-content-center align-items-center carousel-icon-control carousel-icon-control--next"
      href="#<%= id %>-mobile"
      role="button"
      data-slide="next"
    >
      <span class="d-flex justify-content-center align-items-center carousel-icon-control-rounded" aria-hidden="true">
        <%= icon(name: 'arrow-right',
                classes: 'spree-icon-arrow spree-icon-arrow-right',
                width: 20,
                height: 20) %>
      </span>
      <span class="sr-only"><%= Spree.t(:next) %></span>
    </a>
  </div>

  <div id="<%= id %>-desktop" class="carousel slide d-none d-md-block homepage-carousel" data-interval="false">
    <div class="carousel-inner carousel-inner-width">
      <% products.each_slice(4).with_index do |sliced_items, index| %>
        <div class="carousel-item <%= 'active' if index == 0 %>">
          <div class="container position-relative">
            <a
              class="d-flex position-absolute justify-content-center align-items-center carousel-icon-control carousel-icon-control--previous"
              href="#<%= id %>-desktop"
              role="button"
              data-slide="prev"
            >
              <span class="d-flex justify-content-center align-items-center carousel-icon-control-rounded" aria-hidden="true">
                <%= icon(name: 'arrow-right',
                        classes: 'spree-icon-arrow spree-icon-arrow-left',
                        width: 20,
                        height: 20)
                %>
              </span>
              <span class="sr-only"><%= Spree.t(:previous) %></span>
            </a>

            <div class="row carousel-items-container">
              <% sliced_items.each do |item| %>
                <div class="col-3">
                  <div class="single-car-item">
                    <%= render 'spree/shared/product', product: item, image_class: 'w-100' %>
                      <%= form_for item, html: {
                        id: 'add-to-cart-form',
                        class: 'add-to-cart-form'
                      }, method: :post do |f| %>
                        <%= render 'spree/shared/quantity_select', input_name: :quantity %>

                      <%= button_tag class: 'btn btn-primary w-100 text-uppercase font-weight-bold add-to-cart-button', id: 'add-to-cart-button', type: :submit do %>
                        <%= Spree.t(:add_to_cart) %>
                      <% end %>
                    <% end %> 
                  </div>
                </div>
              <% end %>
            </div>

            <a
              class="d-md-flex position-absolute justify-content-center align-items-center carousel-icon-control carousel-icon-control--next"
              href="#<%= id %>-desktop"
              role="button"
              data-slide="next"
            >
              <span class="d-flex justify-content-center align-items-center carousel-icon-control-rounded" aria-hidden="true">
                <%= icon(name: 'arrow-right',
                        classes: 'spree-icon-arrow spree-icon-arrow-right',
                        width: 20,
                        height: 20)
                %>
              </span>
              <span class="sr-only"><%= Spree.t(:next) %></span>
            </a>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
